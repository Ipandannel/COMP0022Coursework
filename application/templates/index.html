<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        /* General Dark Mode Styling */
        body {
            background-color: #1E1E1E; /* Dark background */
            color: #EAEAEA; /* Light text for contrast */
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
        }

        /* Header */
        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            color: #FFD700; /* Gold text for contrast */
            margin-bottom: 20px;
        }

        /* Search & Filters */
        input, select {
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #333; /* Dark input background */
            color: #EAEAEA;
            padding: 8px;
        }
        input::placeholder {
            color: #999;
        }

        /* Movie Results */
        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Grid layout */
            gap: 20px;
            padding: 20px;
        }

        /* Movie Cards */
        .movie-card {
            background: #2C2C2C; /* Darker card background */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 5px 10px rgba(255, 255, 255, 0.1); /* Subtle white glow */
            text-align: center;
            padding: 15px;
            transition: transform 0.2s ease-in-out;
            color: white;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0px 8px 15px rgba(255, 255, 255, 0.2);
        }

        /* Movie Posters */
        .movie-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 5px;
        }

        /* Movie Details */
        .movie-card h5 {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #FFD700; /* Gold text */
        }

        .movie-card p {
            font-size: 14px;
            color: #CCC;
            margin: 5px 0;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            #results {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* 2 per row */
            }
        }

        @media (max-width: 768px) {
            #results {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* 1 per row */
            }
        }
    </style>
</head>
<body class="container mt-4">

    <h1 class="text-center">ðŸŽ¬ Movie Search</h1>

    <!-- Search Input -->
    <div class="mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="Search for a movie..." oninput="searchMovies()">
    </div>

    <!-- Filters for Genre, Rating, and Release Date -->
    <div class="row mb-3">
        <div class="col-md-3">
            <label for="genreSelect" class="form-label">Genre:</label>
            <select id="genreSelect" class="form-control" onchange="searchMovies()">
                <option value="">All Genres</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="minRating" class="form-label">Min Rating:</label>
            <input type="number" id="minRating" class="form-control" step="0.1" min="0" max="5" onchange="searchMovies()">
        </div>
        <div class="col-md-2">
            <label for="maxRating" class="form-label">Max Rating:</label>
            <input type="number" id="maxRating" class="form-control" step="0.1" min="0" max="5" onchange="searchMovies()">
        </div>
        <div class="col-md-2">
            <label for="minReleaseDate" class="form-label">From:</label>
            <input type="date" id="minReleaseDate" class="form-control" onchange="searchMovies()">
        </div>
        <div class="col-md-2">
            <label for="maxReleaseDate" class="form-label">To:</label>
            <input type="date" id="maxReleaseDate" class="form-control" onchange="searchMovies()">
        </div>
    </div>

    <!-- Movie Results -->
    <div id="results"></div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        fetchGenres();
        searchMovies(); // Automatically load all movies when the page loads
    });

    async function fetchGenres() {
        try {
            const response = await fetch("/genres");
            if (!response.ok) throw new Error("Failed to load genres.");
            const genres = await response.json();
            const genreSelect = document.getElementById("genreSelect");
            genres.forEach(genre => {
                const option = document.createElement("option");
                option.value = genre;
                option.textContent = genre;
                genreSelect.appendChild(option);
            });
        } catch (error) {
            console.error("Error loading genres:", error.message);
        }
    }

    async function searchMovies() {
        const query = document.getElementById("searchInput").value.trim();
        const genre = document.getElementById("genreSelect").value;
        const minRating = document.getElementById("minRating").value;
        const maxRating = document.getElementById("maxRating").value;
        const minReleaseDate = document.getElementById("minReleaseDate").value;
        const maxReleaseDate = document.getElementById("maxReleaseDate").value;
        const resultsDiv = document.getElementById("results");

        try {
            const url = new URL("/search", window.location.origin);
            if (query) url.searchParams.append("q", query);
            if (genre) url.searchParams.append("genre", genre);
            if (minRating) url.searchParams.append("min_rating", minRating);
            if (maxRating) url.searchParams.append("max_rating", maxRating);
            if (minReleaseDate) url.searchParams.append("min_release_date", minReleaseDate);
            if (maxReleaseDate) url.searchParams.append("max_release_date", maxReleaseDate);

            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to fetch movies.");
            const movies = await response.json();

            if (movies.length === 0) {
                resultsDiv.innerHTML = "<p class='text-danger'>No results found.</p>";
                return;
            }

            resultsDiv.innerHTML = movies.map(movie => `
                <div class="movie-card">
                    <img src="${movie.poster_url}" alt="${movie.title} Poster">
                    <div>
                        <h5>${movie.title}</h5>
                        <p><strong>Genre:</strong> ${movie.genre}</p>
                        <p><strong>Release Date:</strong> ${movie.release_date}</p>
                        <p><strong>Average Rating:</strong> ${movie.avg_rating.toFixed(1)}</p>
                    </div>
                </div>
            `).join("");
        } catch (error) {
            resultsDiv.innerHTML = `<p class='text-danger'>Error: ${error.message}</p>`;
        }
    }
    </script>

</body>
</html>
