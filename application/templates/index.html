<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        /* General Dark Mode Styling */
        body {
            background-color: #1E1E1E;
            color:  #EAEAEA;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
        }
        .navbar {
            background-color: #333;
            padding: 10px;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
            font-size: 18px;
            padding: 8px;
        }
        .navbar a:hover {
            background-color: #FFD700;
            color: black;
            border-radius: 5px;
        }
        .search-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .search-container input {
            width: 50%; /* Adjust the width */
        }

        /* Header */
        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
        }

        /* Search & Filters */
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        input, select {
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #333;
            color: #EAEAEA;
            padding: 8px;
        }

        /* Toggle Filters Button */
        .btn-toggle {
            background: #FFD700;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Filters Section (Hidden by Default) */
        #filters {
            display: none;
            background: #2C2C2C;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        /* Festival Planner Sidebar */
        .sidebar {
            position: fixed;
            left: -300px; /* Initially hidden */
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #2C2C2C;
            padding: 15px;
            overflow-y: auto;
            box-shadow: 2px 0px 10px rgba(255, 255, 255, 0.1);
            transition: left 0.3s ease-in-out;
            z-index: 1000;
        }

        /* When active, move sidebar into view */
        .sidebar.active {
            left: 0;
        }

        .sidebar h4 {
            color: #FFD700;
            text-align: center;
        }

        /* Genre Checkboxes */
        .genre-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .genre-checkbox {
            margin-right: 5px;
        }

        /* Suggestion Boxes */
        .suggestion-box {
            list-style-type: none;
            background: #444;
            padding: 5px;
            max-height: 150px;
            overflow-y: auto;
            border-radius: 5px;
        }

        .suggestion-box li {
            padding: 5px;
            cursor: pointer;
        }

        .suggestion-box li:hover {
            background: #FFD700;
            color: black;
        }

        /* Movie Results */
        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        /* Movie Cards */
        .movie-card {
            background: #2C2C2C;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 5px 10px rgba(255, 255, 255, 0.1);
            text-align: center;
            padding: 15px;
            transition: transform 0.2s ease-in-out;
            color: white;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0px 8px 15px rgba(255, 255, 255, 0.2);
        }

        .movie-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 5px;
        }
        #festival-planner {
            display: none; /* Hidden by default */
            background: #2C2C2C;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .genre-section {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .genre-section h4 {
            color: #FFD700;
        }

        .genre-section ul {
            list-style: none;
            padding-left: 0;
        }

        .genre-section li {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            background: #444;
            border-radius: 5px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body class="container mt-4">


    <div class="navbar d-flex justify-content-between">
        <div>
            <a href="#" onclick="showSearch()">üè† Home</a>
            <a href="#" onclick="togglePlanner()" id="plannerButton">
                üìÖ Festival Planner (<span id="plannerCount">0</span>)
            </a>
            
        </div>
        <div>
            <a href="#">üîë Login</a>
        </div>
    </div>
    
    <!-- Main Search -->
    <h1 class="text-center">üé¨ Film Dashboard</h1>

    <!-- Search Bar & Filters Button in One Row -->
    <div class="search-container d-flex justify-content-center align-items-center gap-3">
        <input type="text" id="searchInput" class="form-control w-50" placeholder="Search for a movie..." oninput="searchMovies()">
        <button class="btn btn-warning" onclick="toggleFilters()">üîç Filters</button>
    </div>

    <!-- Filters Section (Initially Hidden) - Now Placed Directly Below Search Bar -->
    <div id="filters" class="mt-3" style="display: none;">
        <div class="row mb-3">
            <!-- Genre Checkboxes -->
            <div class="col-md-4">
                <label class="form-label">Genres:</label>
                <div id="genreCheckboxes" class="genre-container"></div>
            </div>

            <!-- Release Date Range (Calendar Picker) -->
            <div class="col-md-4">
                <label class="form-label">Release Date From:</label>
                <input type="date" id="releaseDateFrom" class="form-control" onchange="searchMovies()">
            </div>
            <div class="col-md-4">
                <label class="form-label">Release Date To:</label>
                <input type="date" id="releaseDateTo" class="form-control" onchange="searchMovies()">
            </div>

            <!-- Awards Filters -->
            <div class="col-md-4">
                <label class="form-label">Minimum Awards Won:</label>
                <input type="number" id="minOscars" class="form-control" placeholder="Min Oscars" onchange="searchMovies()">
                <input type="number" id="minGoldenGlobes" class="form-control mt-2" placeholder="Min Golden Globes" onchange="searchMovies()">
                <input type="number" id="minBAFTAs" class="form-control mt-2" placeholder="Min BAFTAs" onchange="searchMovies()">
            </div>

            <!-- Runtime Filters -->
            <div class="col-md-4">
                <label class="form-label">Runtime (Min - Max):</label>
                <input type="number" id="minRuntime" class="form-control" placeholder="Min (mins)" onchange="searchMovies()">
                <input type="number" id="maxRuntime" class="form-control mt-2" placeholder="Max (mins)" onchange="searchMovies()">
            </div>

            <!-- Language Dropdown -->
            <div class="col-md-4">
                <label class="form-label">Language:</label>
                <select id="languageSelect" class="form-control" onchange="searchMovies()">
                    <option value="">All Languages</option>
                </select>
            </div>

            <!-- Director Input with Auto-Suggestions -->
            <div class="col-md-4">
                <label class="form-label">Director:</label>
                <input type="text" id="directorSearch" class="form-control" placeholder="Search for a director..." oninput="fetchDirectors()">
                <ul id="directorSuggestions" class="suggestion-box"></ul>
            </div>

            <!-- Actor Input with Auto-Suggestions -->
            <div class="col-md-4">
                <label class="form-label">Lead Actor:</label>
                <input type="text" id="actorSearch" class="form-control" placeholder="Search for an actor..." oninput="fetchActors()">
                <ul id="actorSuggestions" class="suggestion-box"></ul>
            </div>
        </div>
    </div>


    
    <!-- Filters (Initially Hidden) -->
    <div id="filters">
        <div class="row mb-3">
            <!-- Genre Checkboxes -->
            <div class="col-md-4">
                <label class="form-label">Genres:</label>
                <div id="genreCheckboxes" class="genre-container"></div>
            </div>

            <!-- Release Date Range (Calendar Picker) -->
            <div class="col-md-4">
                <label class="form-label">Release Date From:</label>
                <input type="date" id="releaseDateFrom" class="form-control" onchange="searchMovies()">
            </div>
            <div class="col-md-4">
                <label class="form-label">Release Date To:</label>
                <input type="date" id="releaseDateTo" class="form-control" onchange="searchMovies()">
            </div>

            <!-- Awards Filters -->
            <div class="col-md-4">
                <label class="form-label">Minimum Awards Won:</label>
                <input type="number" id="minOscars" class="form-control" placeholder="Min Oscars" onchange="searchMovies()">
                <input type="number" id="minGoldenGlobes" class="form-control mt-2" placeholder="Min Golden Globes" onchange="searchMovies()">
                <input type="number" id="minBAFTAs" class="form-control mt-2" placeholder="Min BAFTAs" onchange="searchMovies()">
            </div>

            <!-- Runtime Filters -->
            <div class="col-md-4">
                <label class="form-label">Runtime (Min - Max):</label>
                <input type="number" id="minRuntime" class="form-control" placeholder="Min (mins)" onchange="searchMovies()">
                <input type="number" id="maxRuntime" class="form-control mt-2" placeholder="Max (mins)" onchange="searchMovies()">
            </div>

            <!-- Language Dropdown -->
            <div class="col-md-4">
                <label class="form-label">Language:</label>
                <select id="languageSelect" class="form-control" onchange="searchMovies()">
                    <option value="">All Languages</option>
                </select>
            </div>

            <!-- Director Input with Auto-Suggestions -->
            <div class="col-md-4">
                <label class="form-label">Director:</label>
                <input type="text" id="directorSearch" class="form-control" placeholder="Search for a director..." oninput="fetchDirectors()">
                <ul id="directorSuggestions" class="suggestion-box"></ul>
            </div>

            <!-- Actor Input with Auto-Suggestions -->
            <div class="col-md-4">
                <label class="form-label">Lead Actor:</label>
                <input type="text" id="actorSearch" class="form-control" placeholder="Search for an actor..." oninput="fetchActors()">
                <ul id="actorSuggestions" class="suggestion-box"></ul>
            </div>
        </div>
    </div>

    <div id="results"></div>

    <!-- üé¨ Festival Planner Section -->
    <h2 class="text-center mt-4" id="planner-title" style="display: none;">üìÖ Festival Movie Planner</h2>
 <!-- üõí Festival Planner Sidebar -->
    <div id="festival-planner-sidebar" class="sidebar">
        <h4 class="text-center">üìÖ Your Festival List</h4>
        <button class="btn btn-danger btn-sm w-100 mb-2" onclick="togglePlanner()">‚ùå Close</button>
        <button class="btn btn-primary mb-3" onclick="showNewListForm()">Create New List</button>
        <div id="newListForm" style="display: none;">
            <input type="text" id="newListTitle" placeholder="List Title" class="form-control mb-2">
            <textarea id="newListNote" placeholder="List Note" class="form-control mb-2"></textarea>
            <button class="btn btn-success" onclick="createNewList()">Add List</button>
        </div>
        <div id="festival-planner-content"></div>
    </div>


    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        fetchGenres();
        fetchLanguages();
        searchMovies();
    });

    function toggleFilters() {
        let filtersDiv = document.getElementById("filters");
        filtersDiv.style.display = (filtersDiv.style.display === "none" || filtersDiv.style.display === "") ? "block" : "none";
    }
    function togglePlanner() {
    let plannerSidebar = document.getElementById("festival-planner-sidebar");
    plannerSidebar.classList.toggle("active");
}


    function showSearch() {
    document.getElementById("festival-planner").style.display = "none";
    document.getElementById("planner-title").style.display = "none";}



    async function fetchGenres() {
        const response = await fetch("/genres");
        const genres = await response.json();
        const genreContainer = document.getElementById("genreCheckboxes");
        genreContainer.innerHTML = genres.map(genre => `
            <label>
                <input type="checkbox" value="${genre}" class="genre-checkbox" onchange="searchMovies()">
                ${genre}
            </label>
        `).join("");
    }

    async function fetchLanguages() {
        const response = await fetch("/languages");
        const languages = await response.json();
        const languageSelect = document.getElementById("languageSelect");
        languages.forEach(lang => {
            const option = document.createElement("option");
            option.value = lang;
            option.textContent = lang;
            languageSelect.appendChild(option);
        });
    }

    async function searchMovies() {
    updatePlannerUI();  // ‚úÖ Ensure UI updates immediately

    const query = document.getElementById("searchInput").value.trim();
    const selectedGenres = [...document.querySelectorAll(".genre-checkbox:checked")].map(cb => cb.value);
    const director = document.getElementById("directorSearch").value.trim();
    const actor = document.getElementById("actorSearch").value.trim();
    const releaseDateFrom = document.getElementById("releaseDateFrom").value;
    const releaseDateTo = document.getElementById("releaseDateTo").value;
    const minOscars = document.getElementById("minOscars").value;
    const minGoldenGlobes = document.getElementById("minGoldenGlobes").value;
    const minBAFTAs = document.getElementById("minBAFTAs").value;
    const minRuntime = document.getElementById("minRuntime").value;
    const maxRuntime = document.getElementById("maxRuntime").value;
    const language = document.getElementById("languageSelect").value;

    const url = new URL("/search", window.location.origin);
    if (query) url.searchParams.append("q", query);
    if (selectedGenres.length) url.searchParams.append("genres", selectedGenres.join(","));
    if (director) url.searchParams.append("director", director);
    if (actor) url.searchParams.append("actor", actor);
    if (releaseDateFrom) url.searchParams.append("releaseDateFrom", releaseDateFrom);
    if (releaseDateTo) url.searchParams.append("releaseDateTo", releaseDateTo);
    if (minOscars) url.searchParams.append("minOscars", minOscars);
    if (minGoldenGlobes) url.searchParams.append("minGoldenGlobes", minGoldenGlobes);
    if (minBAFTAs) url.searchParams.append("minBAFTAs", minBAFTAs);
    if (minRuntime) url.searchParams.append("min_runtime", minRuntime);
    if (maxRuntime) url.searchParams.append("max_runtime", maxRuntime);
    if (language) url.searchParams.append("language", language);

    console.log("Fetching movies from:", url.toString()); // Debug API request

    try {
        const response = await fetch(url);
        const movies = await response.json();

        console.log("API Response:", movies);  // Debug received movies

        const resultsContainer = document.getElementById("results");
        resultsContainer.innerHTML = ""; // Clear previous results

        if (movies.length === 0) {
            resultsContainer.innerHTML = "<p>No movies found.</p>";
            updatePlannerUI(); // ‚úÖ Ensure UI updates immediately
            return;
        }

        resultsContainer.innerHTML = movies.map(movie => `
            <div class="movie-card">
                <img src="${movie.poster_url}" alt="${movie.title} Poster">
                <h5>${movie.title}</h5>
                <p><strong>Genre:</strong> ${movie.genre}</p>
                <p><strong>Director:</strong> ${movie.directors}</p>
                <p><strong>Actors:</strong> ${movie.actors}</p>
                <p><strong>Language:</strong> ${movie.language}</p>
                <p><strong>Runtime:</strong> ${movie.runtime}</p>
                <p><strong>IMDb Rating:</strong> ${movie.imdb_rating}</p>
                <button class="btn btn-warning mt-2" onclick="showListDropdown(this)">üìÖ Add to Planner</button>
                <select class="form-control mt-2 list-selector" style="display: none;"></select>



            </div>
        `).join("");

    } catch (error) {
        console.error("Error fetching movies:", error);
    }
}
    const festivalLists = {}; // Stores lists with their details and movies grouped by genre

    function showNewListForm() {
        document.getElementById("newListForm").style.display = 'block';
    }

    function createNewList() {
        const title = document.getElementById("newListTitle").value.trim();
        const note = document.getElementById("newListNote").value.trim();
        if (!title) {
            alert("Please enter a title for the list.");
            return;
        }
        if (festivalLists[title]) {
            alert("A list with this title already exists.");
            return;
        }
        festivalLists[title] = { note: note, genres: {} };
        document.getElementById("newListForm").style.display = 'none';
        updateListSelectors();
        updatePlannerUI(); // Ensures UI updates to show new list even if it's empty
    }

    function showListDropdown(button) {
        const selector = button.nextElementSibling;
        selector.innerHTML = '<option disabled selected>Select list to insert:</option>';
        Object.keys(festivalLists).forEach(listTitle => {
            const option = document.createElement('option');
            option.textContent = listTitle;
            option.value = listTitle;
            selector.appendChild(option);
        });
        selector.style.display = 'block';
        selector.onchange = function() {
            addToPlanner(this.parentElement, this.value);
            this.style.display = 'none';
        };
    }

    function addToPlanner(card, listTitle) {
        const title = card.querySelector('h5').textContent;
        const genre = card.querySelector('p').textContent.split(': ')[1];
        if (!festivalLists[listTitle].genres[genre]) {
            festivalLists[listTitle].genres[genre] = [];
        }
        if (festivalLists[listTitle].genres[genre].includes(title)) {
            alert("This movie is already in the list!");
            return;
        }
        festivalLists[listTitle].genres[genre].push(title);
        updatePlannerUI();
    }

    function updateListSelectors() {
        // Call this function after adding a new list to update dropdowns in all movie cards
        document.querySelectorAll('.list-selector').forEach(selector => {
            const currentDisplay = selector.style.display;
            selector.innerHTML = '<option disabled selected>Select list to insert:</option>';
            Object.keys(festivalLists).forEach(listTitle => {
                const option = document.createElement('option');
                option.textContent = listTitle;
                option.value = listTitle;
                selector.appendChild(option);
            });
            selector.style.display = currentDisplay;
        });
    }

    function updatePlannerUI() {
        const plannerContent = document.getElementById("festival-planner-content");
        const plannerCount = document.getElementById("plannerCount");

        // Count total movies across all lists
        let totalMovies = Object.values(festivalLists).reduce((sum, list) => sum + Object.values(list.genres).reduce((sum, genreMovies) => sum + genreMovies.length, 0), 0);
        plannerCount.textContent = totalMovies;  // Update the movie count in the sidebar

        // Generate content for each list
        plannerContent.innerHTML = Object.keys(festivalLists).map(listTitle => {
            const list = festivalLists[listTitle];
            return `
                <div class="card bg-dark text-white mb-3">
                    <div class="card-header">${listTitle}</div>
                    <div class="card-body">
                        <h5 class="card-title">${list.note}</h5>
                        ${Object.keys(list.genres).map(genre => `
                            <h6>${genre}</h6>
                            <ul>${list.genres[genre].map(movie => `<li>${movie}</li>`).join("")}</ul>
                        `).join("")}
                    </div>
                </div>
            `;
        }).join("");

        // Show placeholder if no lists are present
        if (Object.keys(festivalLists).length === 0) {
            plannerContent.innerHTML = "<p class='text-center text-white'>No lists created yet.</p>";
        }
    }






    </script>

</body>
</html>
