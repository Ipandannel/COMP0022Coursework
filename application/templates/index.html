<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        /* General Dark Mode Styling */
        body {
            background-color: #1E1E1E;
            color: #EAEAEA;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
        }

        /* Header */
        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
        }

        /* Search Bar */
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        input {
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #333;
            color: #EAEAEA;
            padding: 8px;
            width: 300px;
        }

        /* Filters Section */
        #filters {
            display: none; /* Initially hidden */
            background: #2C2C2C;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Movie Results */
        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        /* Movie Cards */
        .movie-card {
            background: #2C2C2C;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 5px 10px rgba(255, 255, 255, 0.1);
            text-align: center;
            padding: 15px;
            transition: transform 0.2s ease-in-out;
            color: white;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0px 8px 15px rgba(255, 255, 255, 0.2);
        }

        .movie-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            #results {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body class="container mt-4">

    <h1 class="text-center">üé¨ Film Dashboard</h1>

    <!-- Search Input -->
    <div class="search-container">
        <input type="text" id="searchInput" class="form-control" placeholder="Search for a movie..." oninput="searchMovies()">
        <button class="btn btn-warning ms-2" onclick="toggleFilters()">üîç Search Filters</button>
    </div>

    <!-- Filters (Initially Hidden) -->
    <div id="filters">
        <div class="row mb-3">
            <div class="col-md-3">
                <label class="form-label">Genre:</label>
                <select id="genreSelect" class="form-control" onchange="searchMovies()">
                    <option value="">All Genres</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Min Rating:</label>
                <input type="number" id="minRating" class="form-control" step="0.1" min="0" max="5" onchange="searchMovies()">
            </div>
            <div class="col-md-2">
                <label class="form-label">Max Rating:</label>
                <input type="number" id="maxRating" class="form-control" step="0.1" min="0" max="5" onchange="searchMovies()">
            </div>
            <div class="col-md-2">
                <label class="form-label">Director:</label>
                <input type="text" id="directorInput" class="form-control" onchange="searchMovies()">
            </div>
            <div class="col-md-2">
                <label class="form-label">Lead Actor:</label>
                <input type="text" id="actorInput" class="form-control" onchange="searchMovies()">
            </div>
        </div>
    </div>

    <!-- Movie Results -->
    <div id="results"></div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        fetchGenres();
        searchMovies();
    });

    function toggleFilters() {
        let filtersDiv = document.getElementById("filters");
        filtersDiv.style.display = (filtersDiv.style.display === "none" || filtersDiv.style.display === "") ? "block" : "none";
    }

    async function fetchGenres() {
        try {
            const response = await fetch("/genres");
            if (!response.ok) throw new Error("Failed to load genres.");
            const genres = await response.json();
            const genreSelect = document.getElementById("genreSelect");
            genres.forEach(genre => {
                const option = document.createElement("option");
                option.value = genre;
                option.textContent = genre;
                genreSelect.appendChild(option);
            });
        } catch (error) {
            console.error("Error loading genres:", error.message);
        }
    }

    async function searchMovies() {
        const query = document.getElementById("searchInput").value.trim();
        const genre = document.getElementById("genreSelect").value;
        const minRating = document.getElementById("minRating").value;
        const maxRating = document.getElementById("maxRating").value;
        const director = document.getElementById("directorInput").value.trim();
        const actor = document.getElementById("actorInput").value.trim();
        const resultsDiv = document.getElementById("results");

        try {
            const url = new URL("/search", window.location.origin);
            if (query) url.searchParams.append("q", query);
            if (genre) url.searchParams.append("genre", genre);
            if (minRating) url.searchParams.append("min_rating", minRating);
            if (maxRating) url.searchParams.append("max_rating", maxRating);
            if (director) url.searchParams.append("director", director);
            if (actor) url.searchParams.append("actor", actor);

            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to fetch movies.");
            const movies = await response.json();

            if (movies.length === 0) {
                resultsDiv.innerHTML = "<p class='text-danger'>No results found.</p>";
                return;
            }

            resultsDiv.innerHTML = movies.map(movie => `
                <div class="movie-card">
                    <img src="${movie.poster_url}" alt="${movie.title} Poster">
                    <h5>${movie.title}</h5>
                    <p><strong>Genre:</strong> ${movie.genre}</p>
                    <p><strong>Director:</strong> ${movie.directors}</p>
                    <p><strong>Actors:</strong> ${movie.actors}</p>
                    <p><strong>Rating:</strong> ${movie.avg_rating.toFixed(1)}</p>
                </div>
            `).join("");
        } catch (error) {
            resultsDiv.innerHTML = `<p class='text-danger'>Error: ${error.message}</p>`;
        }
    }
    </script>

</body>
</html>
